(this["webpackJsonpflight-visualizer"]=this["webpackJsonpflight-visualizer"]||[]).push([[0],{12:function(e,t,a){e.exports=a(21)},17:function(e,t,a){},19:function(e,t,a){},21:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(5),l=a.n(o),c=(a(17),a(2)),i=a.n(c),s=a(3),u=a(6),p=a(7),m=a(8),f=a(10),d=a(11),h=a(1),g=a.n(h),A=a(9),v=a.n(A);a(19),a(20);g.a.accessToken="pk.eyJ1IjoidG9pbmVodWxzaG9mIiwiYSI6ImNrYjhmZTU5NzAzcm4ydHJ4a2Rla296YWQifQ.rgmnLTeSXSyNSB4kjOtR0A";var y="https://raw.githubusercontent.com/jpatokal/openflights/master/data/",b={},E={},I={},C={},T={},S=[],N=null;function k(e){var t=e.path,a=e.speed,n=e.transferTime;return t?0===t.length?r.a.createElement("div",{className:"path"},r.a.createElement("h4",null,"No Path Found")):r.a.createElement("div",{className:"path"},r.a.createElement("h4",null,"Shortest Path"),r.a.createElement(F,{path:t,speed:a,transferTime:n}),t.map((function(e){var t=T[e.planes.split(" ")[0].replace(/[\r\n]+/gm,"")];return r.a.createElement("table",{className:"path-element"},r.a.createElement("tr",null,r.a.createElement("td",null,"Places:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,b[e.from].place," - ",b[e.to].place))),r.a.createElement("tr",null,r.a.createElement("td",null,"Route:"),r.a.createElement("td",{className:"right-table-cell"},z(b[e.from].country)," ",r.a.createElement("b",null,e.fromIATA," - ",e.toIATA)," ",z(b[e.to].country))),r.a.createElement("tr",null,r.a.createElement("td",null,"Info:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,Math.round(e.distance),"km - ",L(e.distance,a)))),r.a.createElement("tr",null,r.a.createElement("td",null,"Airline:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,C[e.airlineID].name)," ",z(C[e.airlineID].country))),r.a.createElement(w,{plane:t}))}))):""}function w(e){var t=e.plane;return t?r.a.createElement("tr",null,r.a.createElement("td",null,"Airplane:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,t.name))):""}function F(e){var t=e.path,a=e.speed,n=e.transferTime;if(0===t.length)return"";var o=t[0].from,l=t[t.length-1].to;return r.a.createElement("table",{className:"total path-element"},r.a.createElement("tr",null,r.a.createElement("td",null,"Places:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,b[o].place," - ",b[l].place))),r.a.createElement("tr",null,r.a.createElement("td",null,"Route:"),r.a.createElement("td",{className:"right-table-cell"},z(b[o].country)," ",r.a.createElement("b",null,b[o].IATA," - ",b[l].IATA)," ",z(b[l].country))),r.a.createElement("tr",null,r.a.createElement("td",null,"Info:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,Math.round(t.reduce((function(e,t){return e+t.distance}),0)),"km - ",L(t.reduce((function(e,t){return e+t.distance}),0),a)))),r.a.createElement("tr",null,r.a.createElement("td",null,"Stops:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,t.length-1," stops - ",(t.length-1)*n,"h"))),r.a.createElement("tr",null,r.a.createElement("td",null,"Total:"),r.a.createElement("td",{className:"right-table-cell"},r.a.createElement("b",null,O((t.length-1)*n+t.reduce((function(e,t){return e+t.distance}),0)/a)))))}function M(e,t,a){N.getCanvas().style.cursor="pointer";for(var n=e.features[0].properties,r=n.from,o=n.fromIATA,l=n.to,c=n.toIATA,i=(n.airlineCode,n.airlineID),s=n.distance,u=(n.stops,n.planeCodes),p=e.lngLat,m=Math.round(s),f=b[r],d=f?z(f.country):"",h=f?"<b>".concat(f.place,"</b>"):"",g=b[l],A=g?z(g.country):"",v=g?"<b>".concat(g.place,"</b>"):"",y=C[i],E=y?z(y.country):"",I=T[u.split(" ")[0]],S=L(m,a),k=I?"<p>Plane: <b>".concat(I.name,"</b></p>"):"",w=y?"<p>Airline: <b>".concat(y.name," ").concat(E,"</b></p>"):"",F="<p>From: ".concat(h," <b>(").concat(o,") ").concat(d,"</b></p>\n                <p>To: ").concat(v," <b>(").concat(c,") ").concat(A,"</b></p>\n                ").concat(w,"\n                ").concat(k,"\n                <p>Distance: <b>").concat(m,"km (").concat(S,")</b></p>");Math.abs(e.lngLat.lng-p[0])>180;)p[0]+=e.lngLat.lng>p[0]?360:-360;t.setLngLat(p).setHTML(F).addTo(N)}function L(e,t){return O(e/t)}function O(e){var t=Math.floor(e),a=Math.round(e%1*60);return"".concat(t,"h").concat(a,"m")}function x(e){return j.apply(this,arguments)}function j(){return(j=Object(u.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(y+t+".dat").then((function(e){return e.text()})).then((function(e){switch(t){case"airports":e.split("\n").forEach((function(e){var t=e.split(","),a=t[0];b[a]={id:parseInt(a),name:(t[1]||"").replace(/"/g,""),place:(t[2]||"").replace(/"/g,""),country:(t[3]||"").replace(/"/g,""),IATA:(t[4]||"").replace(/"/g,""),ICAO:(t[5]||"").replace(/"/g,""),lat:parseFloat(t[6]),lon:parseFloat(t[7]),altitude:parseInt(t[8]),timezone:t[9],dst:t[10]}}));break;case"routes":E=e.split("\n").reduce((function(e,t){var a=t.split(","),n=a[3],r=parseInt(a[3]),o=parseInt(a[5]),l=b[r],c=b[o],i=1/0;return l&&c&&(i=Q(l.lat,l.lon,c.lat,c.lon)),e[n]=(e[n]||[]).concat({from:r,fromIATA:a[2],to:o,toIATA:a[4],airline:a[0],airlineID:parseInt(a[1]),distance:i,stops:a[7],planes:a[8]}),e}),{});break;case"countries":e.split("\n").forEach((function(e){var t=e.split(",");I[(t[0]||"").replace(/"/g,"")]={name:(t[0]||"").replace(/"/g,""),code:(t[1]||"").replace(/"/g,"")}}));break;case"planes":e.split("\n").forEach((function(e){var t=e.split(",").map((function(e){return e.replace(/"|\\r/g,"")}));T[t[1]]={name:t[0],IATA:t[1],ICAO:t[2]}}));break;case"airlines":e.split("\n").forEach((function(e){var t=e.split(","),a=parseInt(t[0]);C[a]={id:a,name:(t[1]||"").replace(/"/g,""),alias:t[2],IATA:t[3],ICAO:t[4],callsign:t[5],country:(t[6]||"").replace(/"/g,""),active:"Y"===t[7]}}))}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,a,n){console.log("AStar",e,t,a,n);var r=a,o=function(e){return l(e)+c(e)},l=function(e){return u[e.from]+e.distance/r+(e.to===t?0:n)},c=function(e){var a=b[e.to],n=b[t],o=1/0;return a&&n&&(o=Q(a.lat,a.lon,n.lat,n.lon)/r),o},i={},u={},p={},m={};for(var f in b)u[f]=1/0,p[f]=1/0;u[e]=0,i[e]="open";for(var d=Object.keys(u).flatMap((function(e){return parseInt(e)})),h=function(e){var a=d.filter((function(e){return"open"===i[e]}));if(0===a.length)return{v:[]};var n=a.reduce((function(e,t){return p[e]<p[t]?e:t}));if(setTimeout((function(){if(n===t){var e=v(t);N.getSource("exploring").setData({type:"FeatureCollection",features:[]}),N.getSource("path").setData({type:"FeatureCollection",features:e.map((function(e){return{type:"Feature",geometry:{type:"LineString",coordinates:[[b[e.from].lon+(Math.abs(b[e.from].lon-b[e.to].lon)>180?b[e.from].lon>b[e.to].lon?-360:360:0),b[e.from].lat],[b[e.to].lon,b[e.to].lat]]},properties:{from:e.from,fromIATA:e.fromIATA,to:e.to,toIATA:e.toIATA,airlineCode:e.airline,airlineID:e.airlineID,distance:e.distance,stops:e.stops,planeCodes:e.planes}}}))})}else a=n,N.getSource("exploring").setData({type:"FeatureCollection",features:v(a).filter((function(e){return b[e.from]&&b[e.to]})).map((function(e){return{type:"Feature",geometry:{type:"LineString",coordinates:[[b[e.from].lon+(Math.abs(b[e.from].lon-b[e.to].lon)>180?b[e.from].lon>b[e.to].lon?-360:360:0),b[e.from].lat],[b[e.to].lon,b[e.to].lat]]}}}))});var a}),20*e),n===t)return{v:v(t)};i[n]="closed";var r,c=Object(s.a)(E[n]||[]);try{for(c.s();!(r=c.n()).done;){var f=r.value;"closed"!==i[f.to]&&((l(f)<u[f.to]||"open"!==i[f.to])&&(m[f.to]=f,u[f.to]=l(f),p[f.to]=o(f),i[f.to]="open"))}}catch(h){c.e(h)}finally{c.f()}},g=0;g<d.length-1;g++){var A=h(g);if("object"===typeof A)return A.v}return[];function v(t){for(var a=[],n=t;n!==e;)a.push(m[n]),n=m[n].from;return a.reverse()}}function Q(e,t,a,n){var r=P(a-e),o=P(n-t),l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(P(e))*Math.cos(P(a))*Math.sin(o/2)*Math.sin(o/2),c=6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)));return isNaN(c)?1/0:c}function P(e){return e*(Math.PI/180)}function z(e){var t=I[e||""];return t&&t.code&&"\\N"!==t.code&&2===t.code.length?v()(t.code):""}var R=function(e){Object(d.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(p.a)(this,a),(n=t.call(this,e)).state={path:void 0,fromQuery:"",toQuery:"",fromAirports:[],toAirports:[],selectedAirports:[],averageAirplaneSpeed:800,transferTime:2},n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){var e=this;x("countries").then((function(){return x("planes")})).then((function(){return x("airlines")})).then((function(){return x("airports")})).then((function(){return x("routes")})).then((function(){N=new g.a.Map({container:"map",style:"mapbox://styles/mapbox/dark-v10",center:[10,20],zoom:2});var t=[];for(var a in b){var n=b[a];t.push({type:"Feature",geometry:{type:"Point",coordinates:[n.lon,n.lat]},properties:{id:n.id,name:n.name,place:n.place,country:n.country,IATA:n.IATA,ICAO:n.ICAO,connections:(E[n.id]||[]).length,altitude:n.altitude}})}N.once("load",(function(){N.addSource("airports",{type:"geojson",data:{type:"FeatureCollection",features:t}}),N.addLayer({id:"airports",source:"airports",type:"circle",paint:{"circle-opacity":["interpolate",["linear"],["get","connections"],0,.5,500,.75],"circle-stroke-width":1,"circle-radius":["interpolate",["linear"],["get","connections"],0,2,5,4,10,8,50,12,100,16,200,20,500,30,1e3,40],"circle-color":["interpolate",["linear"],["get","altitude"],-100,"#f000ff",0,"#0000ff",150,"#00ff00",300,"#fff000",1e3,"#ff7000",5e3,"#ff0000"]}}),N.addSource("selected",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),N.addLayer({id:"selected",source:"selected",type:"line",paint:{"line-opacity":.75,"line-width":1,"line-color":"#7777bb"}}),N.addSource("connections",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),N.addLayer({id:"connections",source:"connections",type:"line",paint:{"line-opacity":.5,"line-width":1,"line-color":"#777"}}),N.addSource("path",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),N.addLayer({id:"path",source:"path",type:"line",paint:{"line-opacity":1,"line-width":5,"line-color":"#fff"}}),N.addSource("exploring",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),N.addLayer({id:"exploring",source:"exploring",type:"line",paint:{"line-opacity":1,"line-width":3,"line-color":"#eb34e1"}})}));var r=new g.a.Popup({closeButton:!1,closeOnClick:!0,maxWidth:"200px"});N.on("mousemove","selected",(function(t){M(t,r,e.state.averageAirplaneSpeed)})),N.on("mouseleave","selected",(function(e){N.getCanvas().style.cursor="",r.remove()})),N.on("mousemove","path",(function(t){M(t,r,e.state.averageAirplaneSpeed)})),N.on("mouseleave","path",(function(e){N.getCanvas().style.cursor="",r.remove()}));var o=null,l=new g.a.Popup({className:"airport-popup",closeButton:!1,closeOnClick:!0,maxWidth:"200px"});N.on("mousemove","airports",(function(e){if(!o||o!==e.features[0].properties.id){N.getCanvas().style.cursor="pointer";var t=e.features[0].properties,a=t.id,n=t.name,r=t.place,c=t.country,i=t.IATA,s=t.ICAO,u=t.connections,p=t.altitude;o=a;for(var m=z(c),f=e.features[0].geometry.coordinates.slice(),d="\\N"!==i?"<p>IATA: <b>".concat(i,"</b></p>"):"",h="<p>Name: <b>".concat(n,"</b></p>\n                        <p>Place: <b>").concat(r,"</b></p>\n                        <p>Country: <b>").concat(c," ").concat(m,"</b></p>\n                        ").concat(d,"\n                        <p>ICAO: <b>").concat(s,"</b></p>\n                        <p>Connections: <b>").concat(u,"</b></p>\n                        <p>Alititude: <b>").concat(p," feet</b></p>");Math.abs(e.lngLat.lng-f[0])>180;)f[0]+=e.lngLat.lng>f[0]?360:-360;l.setLngLat(f).setHTML(h).addTo(N),N.getSource("connections").setData({type:"FeatureCollection",features:(E[o]||[]).filter((function(e){return b[e.from]&&b[e.to]})).map((function(e){return{type:"Feature",geometry:{type:"LineString",coordinates:[[b[e.from].lon+(Math.abs(b[e.from].lon-b[e.to].lon)>180?b[e.from].lon>b[e.to].lon?-360:360:0),b[e.from].lat],[b[e.to].lon,b[e.to].lat]]}}}))})}})),N.on("mouseleave","airports",(function(e){N.getCanvas().style.cursor="",l.remove(),o=null,N.getSource("connections").setData({type:"FeatureCollection",features:[]})})),N.on("click",(function(t){S=e.state.selectedAirports,e.setState({path:void 0,fromAirports:[],toAirports:[],selectedAirports:[]}),N.getSource("selected").setData({type:"FeatureCollection",features:[]}),N.getSource("path").setData({type:"FeatureCollection",features:[]})})),N.on("click","airports",(function(t){if(e.setState({selectedAirports:S.concat([t.features[0].properties.id])}),2===e.state.selectedAirports.length){var a=D(e.state.selectedAirports[0],e.state.selectedAirports[1],e.state.averageAirplaneSpeed,e.state.transferTime);e.setState({path:a,selectedAirports:[]})}N.getSource("selected").setData({type:"FeatureCollection",features:e.state.selectedAirports.flatMap((function(e){return(E[e]||[]).filter((function(e){return b[e.from]&&b[e.to]})).map((function(e){return{type:"Feature",geometry:{type:"LineString",coordinates:[[b[e.from].lon+(Math.abs(b[e.from].lon-b[e.to].lon)>180?b[e.from].lon>b[e.to].lon?-360:360:0),b[e.from].lat],[b[e.to].lon,b[e.to].lat]]},properties:{from:e.from,fromIATA:e.fromIATA,to:e.to,toIATA:e.toIATA,airlineCode:e.airline,airlineID:e.airlineID,distance:e.distance,stops:e.stops,planeCodes:e.planes}}}))}))})}))}))}},{key:"search",value:function(e){return Object.keys(b).filter((function(t){return b[t].place.toLowerCase().includes(e.toLowerCase())||b[t].IATA.toLowerCase().includes(e.toLowerCase())||b[t].name.toLowerCase().includes(e.toLowerCase())})).slice(0,10)}},{key:"render",value:function(){var e=this,t=this.state,a=t.path,n=t.fromQuery,o=t.toQuery,l=t.fromAirports,c=t.toAirports,i=t.selectedAirports,s=t.averageAirplaneSpeed,u=t.transferTime;return r.a.createElement("div",{className:"App"},r.a.createElement("div",{id:"map"}),r.a.createElement(k,{path:a,speed:s,transferTime:u}),r.a.createElement("div",{className:"welcome"},r.a.createElement("h4",null,r.a.createElement("b",null,"Flight Visualizer")),r.a.createElement("p",null,"Find the shortest route between two airports.",r.a.createElement("br",null),"Click on airports or search them below!"),r.a.createElement("div",{className:"search-box"},r.a.createElement("input",{type:"text",className:"search-bar",onFocus:function(t){return e.setState({fromQuery:""})},placeholder:"From",onChange:function(t){var a=""===t.target.value?[]:e.search(t.target.value);e.setState({fromQuery:t.target.value,fromAirports:a})},value:n}),l.map((function(t){var a=b[t],n=z(a.country),o="(".concat("\\N"===a.IATA?a.ICAO:a.IATA,")");return r.a.createElement("div",{className:"result",onClick:function(r){if(i.length>=1){var o=D(parseInt(t),parseInt(i[0]),s,u);e.setState({path:o,selectedAirports:[],fromAirports:[],fromQuery:"".concat(n," ").concat(a.place," (").concat(a.IATA||a.ICAO,")")})}else e.setState({selectedAirports:[t],fromAirports:[],fromQuery:"".concat(n," ").concat(a.place," (").concat(a.IATA||a.ICAO,")")})}},z(a.country)," ",a.place," ",r.a.createElement("b",null,o))}))),r.a.createElement("div",{className:"search-box"},r.a.createElement("input",{type:"text",className:"search-bar",onFocus:function(t){return e.setState({toQuery:""})},placeholder:"To",onChange:function(t){var a=""===t.target.value?[]:e.search(t.target.value);e.setState({toQuery:t.target.value,toAirports:a})},value:o}),c.map((function(t){var a=b[t],n="(".concat("\\N"===a.IATA?a.ICAO:a.IATA,")"),o=z(a.country);return r.a.createElement("div",{className:"result",onClick:function(n){if(i.length>=1){var r=D(parseInt(i[0]),parseInt(t),s,u);e.setState({path:r,selectedAirports:[],toAirports:[],toQuery:"".concat(o," ").concat(a.place," (").concat(a.IATA||a.ICAO,")")})}else e.setState({selectedAirports:[t],toAirports:[],toQuery:"".concat(o," ").concat(a.place," (").concat(a.IATA||a.ICAO,")")})}},z(a.country)," ",a.place," ",r.a.createElement("b",null,n))}))),r.a.createElement("div",{className:"slider-container"},r.a.createElement("p",null,"Average speed ",s,"km/h"),r.a.createElement("input",{className:"slider",type:"range",min:"400",max:"1200",value:s,id:"myRange",onChange:function(t){e.setState({averageAirplaneSpeed:parseFloat(t.target.value)})}})),r.a.createElement("div",{className:"slider-container"},r.a.createElement("p",null,"Transfer time ",u,"h"),r.a.createElement("input",{className:"slider",type:"range",min:"0",max:"10",step:"0.5",value:u,id:"myRange",onChange:function(t){e.setState({transferTime:parseFloat(t.target.value)})}}))),r.a.createElement("div",{className:"banner"},r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/ToineHulshof/FlightVisualizer"},"\ud83d\udcbbSource Code "),"Toine Hulshof 2020"))}}]),a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(R,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[12,1,2]]]);
//# sourceMappingURL=main.c15f3419.chunk.js.map